REQUIRE %vfxland5%/supershow/mode.vfx
REQUIRE %idir%/viewport.vfx

: 1x  1 user-zoom ! ;
: 2x  2 user-zoom ! ;
: 3x  3 user-zoom ! ;

\ -- Bitmap Creation and Loading -----------------------------------------------

: *sprite ( bmp - sprite )
    %sprite  *add { bmp ! me } ;

: paint ( bmpid - )
    mouse at hud { *paint drop } ;

|| : center
    desktop { x 2@ 2>i 2negate }
    winw winh 2 2 2/ zoom @ dup 2/ 2+ ;

: newbmp ( w h - )
    {: | zbuf[ 1024 ] :}
    0 z" New Bitmap" z" *.png" ALLEGRO_FILECHOOSER_SAVE file-dialog
    dup if 
        -ext f" %s.png" zbuf[ zplace
        al_create_bitmap zbuf[ swap al_save_bitmap 0= abort" Bitmap file create fail!"
        zbuf[ f" bitmap %z" .evaluate
        
        zbuf[ zcount -path evaluate desktop {
            center at *sprite >bmp @ paint
        }
    else
        2drop
    then ;

: loadbmp ( - )
    {: | zbuf[ 1024 ] :}
    0 z" Load Bitmap" z" *.png;*.jpg;*.jpeg;*.bmp;*.tif;*.tiff;*.pcx;*.gif" ALLEGRO_FILECHOOSER_FILE_MUST_EXIST file-dialog
    dup if
        zbuf[ zplace
        zbuf[ f" bitmap %z" .evaluate
        zbuf[ zcount -path evaluate desktop { center at *sprite drop }
    else
        2drop
    then ;
